# rpcクライアント・サーバーのテンプレート生成器

## 概要

関数のインターフェースを所定の書式で記述したファイルを読み込み、それをrpcとして実行するためのサーバーとクライアントのテンプレートを生成します。

サーバー側ではrpcの実装を、クライアント側では自動生成された関数をローカル関数と同じように呼び出すだけで使用可能になります。

## 使用方法

### コード生成

`hogehoge.rpch` に書いてあるように、関数名、戻り値の型、各引数の型と名前を記述します。
`.rpch`ファイルのルールは以下のとおりです。

- 引数の数は1以上です
- `char*`型は、 `char *`とは記述することができません
- 改行が意味を持っており、`hogehoge.rpch`のような改行にしなければうまく動きません
  - 関数名、戻り値、引数は1行に1個
  - `{` と `}` はそれぞれ1行に書かなければならず、空白などを含んではいけない
  - `{` と `}` の間に空行を含んではならない
- 使用可能な型は, int, double, char*の3種類のみです。

`.rpch`の記述が済んだら、プログラムを使用してテンプレートを生成します。

プロジェクトのルートで以下のコマンドを使用することで、テンプレート生成のバイナリをビルドできます。

```
gcc -o template_generator *.c
```

以下のコマンドでテンプレートを生成できます。

```
./template_generator <.rpchファイルの名前>
```

### サーバー側の準備

`gen/server/`以下にサーバーで必要なコードが全て生成されます。
`gen/server/server_template.c`には、実装すべき関数が全て記載されていますので、このファイルに直接実装を書いてください。
関数が消えさえしなければ、新たに自前のヘッダファイルをインクルードしたり、自作の関数を同一フィアル内に作っても問題ありません。

ビルドする際は、`gen/server`以下のファイルを全て含めてコンパイルしてください。

例えば、以下のコマンドでビルドできます。

```
gcc -o server *.c tools/*.c
```

あとは生成されたバイナリを実行すれば自動でサーバーが立ち上がります。

### クライアント側の準備

`gen/client`以下にクライアントで必要なコードが全て生成されます。
`gen/client/client_header.h`には、呼び出すことのできる関数のプロトタイプ宣言が入っていますので、これをインクルードすればrpcを呼び出せるようになります。

ビルドの際は、`gen/client`以下のファイルが全て含まれた状態でコンパイルすれば問題なくrpcを呼び出せるはずです。


## 注意

`gen/`以下のファイルは、テンプレート生成時に上書きされるものとそうでないものがあります。
基本的に`gen/`以下のファイルは削除しないようにしてください。

もし万が一削除してしまった場合は、`gen_template`の中に必要なファイルが全て入っていますので、これをコピーして`gen`と名付け直して使用してください。
